angular.module("myApp",[]).factory("gameLogic",function(){"use strict";function a(){return[[4,4,4,4,4,4],[4,4,4,4,4,4]]}function b(a,b,c){return a[b][c]>(0===b?c:5-c)}function c(a,c){for(var d=0;6>d;d++)if(b(a,c,d))return!0;return!1}function d(a,b){for(var c=0,d=0;6>d;d++)c+=a[b][d];return c}function e(a,b){return 0!==d(a,1)||c(a,0)?0!==d(a,0)||c(a,1)?b[0]>24?0:b[1]>24?1:-1:(b[1]+=d(a,1),1):(b[0]+=d(a,0),0)}function f(a){return 24===a[0]&&24===a[1]?!0:!1}function g(a){var b=a.move,c=a.turnIndexBeforeMove,d=a.stateBeforeMove;try{var e=b[2].set.value,f=e.row,g=e.col,h=d.board,j=d.scores,k=i(h,f,g,c,j);if(!angular.equals(b,k))return!1}catch(l){return console.log(l),!1}return!0}function h(a,b,c){for(var d=[],e=0;6>e;e++)try{0!==a[b][e]&&d.push(i(a,b,e,b,c))}catch(f){}return d}function i(c,g,h,i,j){if(void 0===c&&(c=a(),j=[0,0]),i!==g)throw new Error("One can only sow seeds from his own houses!");if(0===c[g][h])throw new Error("One cannot sow seeds from empty house!");if(-1!==e(c,j)||f(j))throw new Error("Can only make a move if the game is not over!");if(!b(c,g,h)&&0===d(c,1-g))throw new Error("Cannot prevent the opponent from continuing the game!");var k=angular.copy(c),l=angular.copy(j),m=k[g][h],n=g,o=h,p=0===n?-1:1;for(k[n][o]=0;m>0;)o+=p,-1===o?(n=1,o=0,p*=-1):6===o&&(n=0,o=5,p*=-1),(n!==g||o!==h)&&(k[n][o]++,m--);p*=-1;var q=0,r=angular.copy(k),s=l[i];if(n===1-i)for(;o>=0&&5>=o&&(2===k[n][o]||3===k[n][o]);)l[i]+=k[n][o],k[n][o]=0,q++,o+=p;6===q&&(k=r,l[i]=s);var t,u=e(k,l);return t=-1!==u||f(l)?{endMatch:{endMatchScores:0===u?[1,0]:1===u?[0,1]:[0,0]}}:{setTurn:{turnIndex:1-i}},[t,{set:{key:"board",value:k}},{set:{key:"delta",value:{row:g,col:h}}},{set:{key:"scores",value:l}}]}return{getInitialBoard:a,getPossibleMoves:h,createMove:i,isMoveOk:g}}),angular.module("myApp").controller("Ctrl",["$rootScope","$scope","$log","$timeout","gameService","stateService","gameLogic","aiService","resizeGameAreaService","$translate","dragAndDropService",function(a,b,c,d,e,f,g,h,i,j,k){"use strict";function l(a,c,d){if(!I&&b.isYourTurn){var e=n(),f=Math.min(Math.max(c-y.offsetLeft,0),y.clientWidth-e.width),g=Math.min(Math.max(d-y.offsetTop,0),y.clientHeight-e.height),h=Math.floor(z*g/y.clientHeight),i=Math.floor(A*f/y.clientWidth);if("touchstart"===a&&!G){B={row:h,col:i},C=angular.element(document.getElementById("e2e_test_seeds_"+B.row+"x"+B.col)),D=C.parent(),D.addClass("selected"),F=+C.text(),M=angular.copy(b.board),M[h][i]=0,b.$apply();var j=C[0].getBoundingClientRect();E={left:j.left-y.offsetLeft,top:j.top-y.offsetTop},G=angular.element('<div class="seeds dragging">'+F+"</div>"),G.css({"z-index":++H,top:Math.round(E.top)+"px",left:Math.round(E.left)+.25*e.width+"px",width:.3*e.width+"px",height:.3*e.width+"px","font-size":.2*e.width+"px",padding:.1*e.width+"px","line-height":.3*e.width+"px"}),angular.element(y).append(G)}if(G){if("touchend"===a){var k={row:h,col:i},l=k.col-B.col;0===B.row&&l>0||1===B.row&&0>l||(L=x(B.row,B.col),L&&(J=v(B.row,B.col,b.board,L[1].set.value),K=0,I=!0,t()))}else m(h,i);("touchend"===a||"touchcancel"===a||"touchleave"===a)&&(I||q(F))}}}function m(a,b){var c=o(a,b),d=n();G.css({left:c.left+(0===a?0:d.width/2)+"px",top:c.top+"px"})}function n(){return{width:y.clientWidth/A,height:y.clientHeight/z}}function o(a,b){var c=n();return{top:0===a?.42*c.height:1.1*c.height,left:b*c.width}}function p(a,b){return 0===a?b--:b++,0>b?(a=1,b=0):b>5&&(a=0,b=5),{row:a,col:b}}function q(a){G[0].style.opacity=0,D.removeClass("selected"),setTimeout(function(){M[B.row][B.col]=a,b.$apply(),G.detach(),G=null,B=null},100)}function r(a,c){if(K<J.updates.length){var d=J.updates[K++];m(d.row,d.col),G.text(--a);var e=angular.element(document.getElementById("pit_"+d.row+"x"+d.col)).addClass("pos");setTimeout(function(){e.removeClass("pos")},2500);var f=angular.element(document.getElementById("e2e_test_seeds_"+d.row+"x"+d.col));M[d.row][d.col]=+f.text()+1,("2"===M[d.row][d.col]||"3"===M[d.row][d.col])&&e.addClass("captured"),b.$apply(function(){setTimeout(function(){r(a,c)},400)})}else K=0,setTimeout(function(){s(c)},400)}function s(a){if(K<J.captures.length){N[b.turnIndex].addClass("capture"),G.addClass("capture");var c=J.captures[K++];m(c.row,c.col);var d=angular.element(document.getElementById("e2e_test_seeds_"+c.row+"x"+c.col));G.text(+G.text()+ +d.text()),M[c.row][c.col]=0,b.$apply(),setTimeout(function(){s(a)},400)}else K=0,setTimeout(a,100)}function t(){r(F,function(){q(0),e.makeMove(L),N[b.turnIndex].removeClass("capture"),L=null,I=!1})}function u(){var a=g.getPossibleMoves(b.board,b.turnIndex,b.scores);e.makeMove(a[Math.floor(Math.random()*a.length)])}function v(a,b,c,d){for(var e,f=[],g=[],h={row:a,col:b},i=c[a][b];i;)h=p(h.row,h.col),(h.row!==a||h.col!==b)&&(e=d[h.row][h.col]-c[h.row][h.col],e>0?f.push({row:h.row,col:h.col}):0>e&&(f.push({row:h.row,col:h.col}),g.push({row:h.row,col:h.col})),i--);return g.reverse(),{updates:f,captures:g}}function w(a){b.board=a.stateAfterMove.board,b.delta=a.stateAfterMove.delta,b.scores=a.stateAfterMove.scores,void 0===b.board&&(b.board=g.getInitialBoard(),b.scores=[0,0]),b.validMoves=g.getPossibleMoves(b.board,a.turnIndexAfterMove,b.scores),b.isYourTurn=a.turnIndexAfterMove>=0&&a.yourPlayerIndex===a.turnIndexAfterMove,b.turnIndex=a.turnIndexAfterMove,b.isYourTurn&&""===a.playersInfo[a.yourPlayerIndex].playerId&&(b.isYourTurn=!1,d(u,500))}function x(a,d){if(c.info(["Clicked on cell:",a,d]),"?throwException"===window.location.search)throw new Error("Throwing the error because URL has '?throwException'");if(!b.isYourTurn)return!1;try{var e=g.createMove(b.board,a,d,b.turnIndex,b.scores);return b.isYourTurn=!1,e}catch(f){return c.info(["Cell is already full in position:",a,d]),!1}}var y=document.getElementById("gameArea"),z=2,A=6,B=null,C=null,D=null,E=null,F=null,G=null,H=15,I=!1,J=null,K=0,L=null,M=null,N=[angular.element(document.getElementById("e2e_test_player1score")).parent(),angular.element(document.getElementById("e2e_test_player2score")).parent()];k.addDragListener("gameArea",l),b.scores=[0,0],i.setWidthToHeight(1.6),window.e2e_test_stateService=f,b.isValid=function(a,c){for(var d=0;d<b.validMoves.length;d++){var e=b.validMoves[d][2].set.value;if(a===e.row&&c===e.col)return!0}return!1},b.getSeeds=function(a,c){return I?M[a][c]:b.board[a][c]},b.getScore=function(a){return b.scores[a]},e.setGame({gameDeveloperEmail:"rsjangle27@gmail.com",minNumberOfPlayers:2,maxNumberOfPlayers:2,isMoveOk:g.isMoveOk,updateUI:w})}]),angular.module("myApp").factory("aiService",["alphaBetaService","gameLogic",function(a,b){"use strict";function c(b,c,g,h){return a.alphaBetaDecision([null,{set:{key:"board",value:b}},null,{set:{key:"scores",value:c}}],g,e,d,"?debug"===window.location.search?f:null,h)}function d(a){if(a[0].endMatch){var b=a[0].endMatch.endMatchScores;return b[0]>b[1]?Number.POSITIVE_INFINITY:b[0]<b[1]?Number.NEGATIVE_INFINITY:0}return 0}function e(a,c){return b.getPossibleMoves(a[1].set.value,c,a[3].set.value)}function f(a){return"\n"+a[1].set.value.join("\n")+"\n"}return{createComputerMove:c}}]);
//# sourceMappingURL=everything.min.js.map