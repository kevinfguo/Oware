angular.module("myApp",[]).factory("gameLogic",function(){"use strict";function a(){return[[4,4,4,4,4,4],[4,4,4,4,4,4]]}function b(a,b,c){return a[b][c]>(0===b?c:5-c)}function c(a,c){for(var d=0;6>d;d++)if(b(a,c,d))return!0;return!1}function d(a,b){for(var c=0,d=0;6>d;d++)c+=a[b][d];return c}function e(a,b){return 0!==d(a,1)||c(a,0)?0!==d(a,0)||c(a,1)?b[0]>24?0:b[1]>24?1:-1:(b[1]+=d(a,1),1):(b[0]+=d(a,0),0)}function f(a){return 24===a[0]&&24===a[1]?!0:!1}function g(a){var b=a.move,c=a.turnIndexBeforeMove,d=a.stateBeforeMove;try{var e=b[2].set.value,f=e.row,g=e.col,h=d.board,j=d.scores,k=i(h,f,g,c,j);if(!angular.equals(b,k))return console.log(JSON.stringify(b,null,2),JSON.stringify(k,null,2)),!1}catch(l){return console.log(l),!1}return!0}function h(a,b,c){for(var d=[],e=0;6>e;e++)try{d.push(i(a,b,e,b,c))}catch(f){}return d}function i(c,g,h,i,j){if(void 0===c&&(c=a(),j=[0,0]),i!==g)throw new Error("One can only sow seeds from his own houses!");if(0===c[g][h])throw new Error("One cannot sow seeds from empty house!");if(-1!==e(c,j)||f(j))throw new Error("Can only make a move if the game is not over!");if(!b(c,g,h)&&0===d(c,1-g))throw new Error("Cannot prevent the opponent from continuing the game!");var k=angular.copy(c),l=angular.copy(j),m=k[g][h],n=g,o=h,p=0===n?-1:1;for(k[n][o]=0;m>0;)o+=p,-1===o?(n=1,o=0,p*=-1):6===o&&(n=0,o=5,p*=-1),(n!==g||o!==h)&&(k[n][o]++,m--);p*=-1;var q=0,r=angular.copy(k),s=l[i];if(n===1-i)for(;o>=0&&5>=o&&(2===k[n][o]||3===k[n][o]);)l[i]+=k[n][o],k[n][o]=0,q++,o+=p;6===q&&(k=r,l[i]=s);var t,u=e(k,l);return t=-1!==u||f(l)?{endMatch:{endMatchScores:0===u?[1,0]:1===u?[0,1]:[0,0]}}:{setTurn:{turnIndex:1-i}},[t,{set:{key:"board",value:k}},{set:{key:"delta",value:{row:g,col:h}}},{set:{key:"scores",value:l}}]}return{getInitialBoard:a,getPossibleMoves:h,createMove:i,isMoveOk:g}}),angular.module("myApp").controller("Ctrl",["$scope","$log","$timeout","gameService","stateService","gameLogic","resizeGameAreaService",function(a,b,c,d,e,f,g){"use strict";function h(b,c,d){if(!E&&a.isYourTurn){var e=j(),f=Math.min(Math.max(c-u.offsetLeft,0),u.clientWidth-e.width),g=Math.min(Math.max(d-u.offsetTop,0),u.clientHeight-e.height),h=Math.floor(v*g/u.clientHeight),k=Math.floor(w*f/u.clientWidth);if("touchstart"===b&&!C){x={row:h,col:k},y=angular.element(document.getElementById("e2e_test_seeds_"+x.row+"x"+x.col)),z=y.parent(),z.addClass("selected"),B=+y.text(),I=angular.copy(a.board),I[h][k]=0,a.$apply();var l=y[0].getBoundingClientRect();A={left:l.left-u.offsetLeft,top:l.top-u.offsetTop},C=angular.element('<div class="seeds dragging">'+B+"</div>"),C.css({"z-index":++D,top:Math.round(A.top)+"px",left:Math.round(A.left)+.25*e.width+"px",width:.3*e.width+"px",height:.3*e.width+"px","font-size":.2*e.width+"px",padding:.1*e.width+"px","line-height":.3*e.width+"px"}),angular.element(u).append(C)}if(C){if("touchend"===b){var n={row:h,col:k},o=n.col-x.col;0===x.row&&o>0||1===x.row&&0>o||(H=t(x.row,x.col),H&&(F=r(x.row,x.col,a.board,H[1].set.value),G=0,E=!0,p()))}else i(h,k);("touchend"===b||"touchcancel"===b||"touchleave"===b)&&(E||m(B))}}}function i(a,b){var c=k(a,b),d=j();C.css({left:c.left+(0===a?0:d.width/2)+"px",top:c.top+"px"})}function j(){return{width:u.clientWidth/w,height:u.clientHeight/v}}function k(a,b){var c=j();return{top:0===a?.42*c.height:1.1*c.height,left:b*c.width}}function l(a,b){return 0===a?b--:b++,0>b?(a=1,b=0):b>5&&(a=0,b=5),{row:a,col:b}}function m(b){C[0].style.opacity=0,z.removeClass("selected"),setTimeout(function(){I[x.row][x.col]=b,a.$apply(),C.detach(),C=null,x=null},100)}function n(b,c){if(G<F.updates.length){var d=F.updates[G++];i(d.row,d.col),C.text(--b);var e=angular.element(document.getElementById("pit_"+d.row+"x"+d.col)).addClass("pos");setTimeout(function(){e.removeClass("pos")},2500);var f=angular.element(document.getElementById("e2e_test_seeds_"+d.row+"x"+d.col));I[d.row][d.col]=+f.text()+1,("2"===I[d.row][d.col]||"3"===I[d.row][d.col])&&e.addClass("captured"),a.$apply(function(){setTimeout(function(){n(b,c)},400)})}else G=0,setTimeout(function(){o(c)},400)}function o(b){if(G<F.captures.length){J[a.turnIndex].addClass("capture"),C.addClass("capture");var c=F.captures[G++];i(c.row,c.col);var d=angular.element(document.getElementById("e2e_test_seeds_"+c.row+"x"+c.col));C.text(+C.text()+ +d.text()),I[c.row][c.col]=0,a.$apply(),setTimeout(function(){o(b)},400)}else G=0,setTimeout(b,100)}function p(){n(B,function(){m(0),d.makeMove(H),J[a.turnIndex].removeClass("capture"),H=null,E=!1})}function q(){var b=f.getPossibleMoves(a.board,a.captures,a.turnIndex);d.makeMove(b[Math.floor(Math.random()*b.length)])}function r(a,b,c,d){for(var e,f=[],g=[],h={row:a,col:b},i=c[a][b];i;)h=l(h.row,h.col),(h.row!==a||h.col!==b)&&(e=d[h.row][h.col]-c[h.row][h.col],e>0?f.push({row:h.row,col:h.col}):0>e&&(f.push({row:h.row,col:h.col}),g.push({row:h.row,col:h.col})),i--);return g.reverse(),{updates:f,captures:g}}function s(b){a.board=b.stateAfterMove.board,a.delta=b.stateAfterMove.delta,a.scores=b.stateAfterMove.scores,void 0===a.board&&(a.board=f.getInitialBoard(),a.scores=[0,0]),a.validMoves=f.getPossibleMoves(a.board,b.turnIndexAfterMove,a.scores),a.isYourTurn=b.turnIndexAfterMove>=0&&b.yourPlayerIndex===b.turnIndexAfterMove,a.turnIndex=b.turnIndexAfterMove,a.isYourTurn&&""===b.playersInfo[b.yourPlayerIndex].playerId&&(a.isYourTurn=!1,c(q,500))}function t(c,d){if(b.info(["Clicked on cell:",c,d]),"?throwException"===window.location.search)throw new Error("Throwing the error because URL has '?throwException'");if(!a.isYourTurn)return!1;try{var e=f.createMove(a.board,c,d,a.turnIndex,a.scores);return a.isYourTurn=!1,e}catch(g){return b.info(["Cell is already full in position:",c,d]),!1}}var u=document.getElementById("gameArea"),v=2,w=6,x=null,y=null,z=null,A=null,B=null,C=null,D=15,E=!1,F=null,G=0,H=null,I=null,J=[angular.element(document.getElementById("e2e_test_player1score")).parent(),angular.element(document.getElementById("e2e_test_player2score")).parent()];window.handleDragEvent=h,a.scores=[0,0],g.setWidthToHeight(1.6),window.e2e_test_stateService=e,a.isValid=function(b,c){for(var d=0;d<a.validMoves.length;d++){var e=a.validMoves[d][2].set.value;if(b===e.row&&c===e.col)return!0}return!1},a.getSeeds=function(b,c){return E?I[b][c]:a.board[b][c]},a.getScore=function(b){return a.scores[b]},d.setGame({gameDeveloperEmail:"rsjangle27@gmail.com",minNumberOfPlayers:2,maxNumberOfPlayers:2,isMoveOk:f.isMoveOk,updateUI:s})}]),angular.module("myApp").factory("aiService",["alphaBetaService","gameLogic",function(a,b){"use strict";function c(b,c,g,h){return a.alphaBetaDecision([null,{set:{key:"board",value:b}},null,{set:{key:"scores",value:c}}],g,e,d,"?debug"===window.location.search?f:null,h)}function d(a){if(a[0].endMatch){var b=a[0].endMatch.endMatchScores;return b[0]>b[1]?Number.POSITIVE_INFINITY:b[0]<b[1]?Number.NEGATIVE_INFINITY:0}return 0}function e(a,c){return b.getPossibleMoves(a[1].set.value,c,a[3].set.value)}function f(a){return"\n"+a[1].set.value.join("\n")+"\n"}return{createComputerMove:c}}]);
//# sourceMappingURL=everything.min.js.map